<html>
<head></head>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script lang="js">
    
    async function run(){
        const trainingUrl = '/data/wdbc-train.csv';
        
        // Specify the label column for training data
        const trainingData = tf.data.csv(trainingUrl, {
            columnConfigs: {
                diagnosis: {
                    isLabel: true
                }
            }
        });
        
        // Convert the training data into arrays
        const convertedTrainingData = await convertDataToArray(trainingData);
              
        const testingUrl = '/data/wdbc-test.csv';
        
        // Specify the label column for testing data
        const testingData = tf.data.csv(testingUrl, {
            columnConfigs: {
                diagnosis: {
                    isLabel: true
                }
            }
        });
        
        // Convert the testing data into arrays
        const convertedTestingData = await convertDataToArray(testingData);

        // Specify the number of features
        const numOfFeatures = convertedTrainingData.xs.shape[1];
        
        // Create a neural network
        const model = tf.sequential();
        
        // Add layers to the model
        model.add(tf.layers.dense({inputShape: [numOfFeatures], units: 64, activation: 'relu'}));
        model.add(tf.layers.dense({units: 32, activation: 'relu'}));
        model.add(tf.layers.dense({units: 1, activation: 'sigmoid'}));

        // Compile the model
        model.compile({
            optimizer: tf.train.rmsprop(),
            loss: 'binaryCrossentropy',
            metrics: ['accuracy']
        });
        
        // Fit the model to the training data
        await model.fit(convertedTrainingData.xs, convertedTrainingData.ys, {
            epochs: 100,
            validationData: [convertedTestingData.xs, convertedTestingData.ys],
            callbacks: {
                onEpochEnd: async(epoch, logs) => {
                    console.log("Epoch: " + epoch + " Loss: " + logs.loss + " Accuracy: " + logs.acc);
                }
            }
        });
        
        // Save the model
        await model.save('downloads://my_model');
    }

    async function convertDataToArray(data) {
        const dataArray = await data.toArray();
        const labels = dataArray.map(item => item.diagnosis === 'M' ? 1 : 0);
        const features = dataArray.map(item => Object.values(item).slice(1).map(Number));
        const xs = tf.tensor2d(features);
        const ys = tf.tensor1d(labels);
        return { xs, ys };
    }

    run();
</script>
<body>
</body>
</html>
